<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Malaysia House Affordability Map</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>

  <style>
    body {
      font-family: 'Times New Roman', serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      font-size: 28px;
      margin-top: 20px;
      text-align: center;
    }
    .subtitle {
      font-size: 16px;
      color: #555;
      margin-bottom: 10px;
      text-align: center;
    }
    #vis {
      width: 900px;
      height: 650px;
    }
  </style>
</head>
<body>
  <h1>Housing Affordability Across Malaysia (2012-2022)</h1>
  <div class="subtitle">
    Based on median household salary, states with higher 
    House Affordability Index values are more expensive to live in.
  </div>
  <div id="vis"></div>

  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": null, // Using HTML title
      "width": 700,
      "height": 600,
      "projection": {"type": "equalEarth"},
      "data": {
        "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179/main/Week9Homework/malaysia_map.topojson",
        "format": {"type": "topojson", "feature": "my"}
      },
      "transform": [
        {
          "lookup": "properties.name",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179/main/Week9Homework/house_affordability.csv",
              "format": {"type": "csv"}
            },
            "key": "State",
            "fields": ["HAI"]
          }
        },
        {
          "calculate": "datum.HAI == null ? null : (datum.HAI <= 70 ? 'Less than 70' : datum.HAI <= 90 ? '71 to 90' : datum.HAI <= 110 ? '91 to 110' : datum.HAI <= 130 ? '111 to 130' : datum.HAI <= 150 ? '131 to 150' : datum.HAI <= 170 ? '151 to 170' : 'Above 170')",
          "as": "HAI_cat"
        }
      ],
      "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.5},
      "encoding": {
        "color": {
          "condition": {"test": "datum.HAI == null", "value": "#eeeeee"},
          "field": "HAI_cat",
          "type": "nominal",
          "scale": {
            "domain": [
              "Less than 70",
              "71 to 90",
              "91 to 110",
              "111 to 130",
              "131 to 150",
              "151 to 170",
              "Above 170"
            ],
            "range": [
                "#deebf7",
                "#c6dbef",
                "#9ecae1",
                "#6baed6",
                "#4292c6",
                "#2171b5",
                "#084594"  
            ]
          },
          "legend": {
            "title": "House Affordability Index",
            "titleFontSize": 14,
            "labelFontSize": 12,
            "symbolSize": 200,
            "orient": "right",
            "offset": 20,
            "padding": 10
          }
        },
        "tooltip": [
          {"field": "properties.name", "type": "nominal", "title": "State"},
          {"field": "HAI", "type": "quantitative", "format": ".2f", "title": "HAI"},
          {"field": "HAI_cat", "type": "nominal", "title": "Category"}
        ]
      }
    };

    vegaEmbed("#vis", spec, {mode: "vega-lite", actions: false})
      .then(console.log)
      .catch(console.warn);
  </script>
</body>
</html>
